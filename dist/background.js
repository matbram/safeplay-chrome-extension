(()=>{"use strict";var e={167(e,t,r){r.d(t,{B3:()=>_,D4:()=>v,F3:()=>b,I4:()=>A,TN:()=>R,c4:()=>S,dF:()=>w,hD:()=>C,lX:()=>m,m_:()=>N,rz:()=>D,setAuthToken:()=>T,setCreditInfo:()=>P,setSubscriptionTier:()=>E,setUserCredits:()=>F,setUserId:()=>k,setUserProfile:()=>U,setUserSubscription:()=>O,v_:()=>I,wR:()=>x});var s=r(574);const a="safeplay_preferences",o="safeplay_auth_token",n="safeplay_refresh_token",i="safeplay_token_expires_at",c="safeplay_user_id",l="safeplay_subscription_tier",u="safeplay_credit_info",d="safeplay_credit_cache_time",h="safeplay_cached_transcripts",f="safeplay_user_profile",g="safeplay_user_subscription",p="safeplay_user_credits",y="safeplay_profile_cache_time";async function m(){return(await chrome.storage.local.get(a))[a]||s.d}async function w(e){const t={...await m(),...e};return await chrome.storage.local.set({[a]:t}),t}async function _(){try{const e=`https://trysafeplay.com/api/extension/session?extensionId=${chrome.runtime.id}`;console.log("[SafePlay Storage] üîÑ Refreshing token via website session..."),console.log("[SafePlay Storage] Endpoint:",e);const t=await fetch(e,{method:"GET",credentials:"include"});if(console.log("[SafePlay Storage] Response status:",t.status),!t.ok){const e=await t.text();return console.log("[SafePlay Storage] ‚ùå Session fetch failed:",{status:t.status,statusText:t.statusText,body:e.substring(0,200)}),null}const r=await t.json();if(console.log("[SafePlay Storage] Response data:",{authenticated:r.authenticated,hasToken:!!r.token,tokenLength:r.token?.length,hasRefreshToken:!!r.refreshToken,refreshTokenLength:r.refreshToken?.length,expiresAt:r.expiresAt,expiresAtDate:r.expiresAt?new Date(r.expiresAt).toISOString():null}),!r.authenticated)return console.log("[SafePlay Storage] ‚ùå User not authenticated on website - clearing local tokens"),await chrome.storage.local.remove([o,n,i]),null;const s=Math.floor(r.expiresAt/1e3);return await chrome.storage.local.set({[o]:r.token,[n]:r.refreshToken,[i]:s}),console.log("[SafePlay Storage] ‚úÖ Token refreshed successfully via website session"),console.log("[SafePlay Storage] New token expires:",new Date(1e3*s).toISOString()),r.token}catch(e){return console.log("[SafePlay Storage] ‚ùå Session refresh error:",e),null}}async function S(){const e=await chrome.storage.local.get([o,n,i]),t=e[o],r=e[n],s=e[i];if(!t)return null;if(s){const e=Date.now();let t=s;s<1e10&&(t=1e3*s);const a=t-e,n=a<3e5;if(a<0){if(console.log("[SafePlay Storage] Token expired:",{expiresAt:s,expiresAtMs:t,now:e,expiredAgo:Math.abs(a)/1e3+" seconds",hasRefreshToken:!!r,refreshTokenLength:r?.length}),r){const e=await _();if(e)return e}return console.log("[SafePlay Storage] Token expired and refresh failed"),await chrome.storage.local.remove([o]),null}if(n&&(console.log("[SafePlay Storage] Token expiring soon:",{expiresIn:a/1e3+" seconds",hasRefreshToken:!!r}),r)){const e=await _();if(e)return e;console.log("[SafePlay Storage] Proactive refresh failed but token still valid, using existing token")}}return t}async function b(){return!!(await chrome.storage.local.get(n))[n]}async function T(e,t,r){console.log("[SafePlay Storage] setAuthToken called:",{hasToken:!!e,tokenLength:e?.length,hasRefreshToken:!!t,refreshTokenLength:t?.length,refreshTokenPreview:t?`${t.substring(0,10)}...`:"none",expiresAt:r,expiresAtType:typeof r});const s={[o]:e};if(t&&(s[n]=t),r){let e=r;r>1e10&&(console.log("[SafePlay Storage] expiresAt appears to be in milliseconds, converting to seconds"),e=Math.floor(r/1e3)),s[i]=e,console.log("[SafePlay Storage] Storing expiresAt:",e,"(seconds), expires:",new Date(1e3*e).toISOString())}await chrome.storage.local.set(s),console.log("[SafePlay Storage] Auth tokens stored successfully")}async function k(e){await chrome.storage.local.set({[c]:e})}async function E(e){await chrome.storage.local.set({[l]:e})}async function A(){try{const e=await chrome.storage.local.get([u,d]),t=e[d],r=e[u];return t&&r&&Date.now()-t<3e5?r:null}catch(e){return console.error("[SafePlay Storage] Error getting credit info:",e),null}}async function P(e){try{await chrome.storage.local.set({[u]:e,[d]:Date.now()})}catch(e){console.error("[SafePlay Storage] Error setting credit info:",e)}}async function I(e){try{const t=(await chrome.storage.local.get(h))[h]||{},r=t[e];if(!r)return null;if(r.transcript)return r.timestamp=Date.now(),await chrome.storage.local.set({[h]:t}),r.transcript;if(r.segments){const s=r;return t[e]={transcript:s,timestamp:Date.now()},await chrome.storage.local.set({[h]:t}),s}return null}catch(e){return console.error("[SafePlay Storage] Error getting cached transcript:",e),null}}async function C(e,t){try{let r=(await chrome.storage.local.get(h))[h]||{};r[e]={transcript:t,timestamp:Date.now()};const s=Object.entries(r);if(s.length>15){s.sort((e,t)=>e[1].timestamp-t[1].timestamp);const e=s.slice(-15);r=Object.fromEntries(e),console.log("[SafePlay Storage] Trimmed transcript cache to 15 entries")}await chrome.storage.local.set({[h]:r})}catch(r){if(r instanceof Error&&r.message.includes("quota")){console.warn("[SafePlay Storage] Quota exceeded, clearing transcript cache..."),await v();try{const r={[e]:{transcript:t,timestamp:Date.now()}};await chrome.storage.local.set({[h]:r}),console.log("[SafePlay Storage] Cache cleared and new transcript saved")}catch(e){console.error("[SafePlay Storage] Failed to save transcript after clearing cache:",e)}}else console.error("[SafePlay Storage] Error caching transcript:",r)}}async function v(){await chrome.storage.local.remove(h)}async function x(){return null!==await S()}async function R(){if(!await async function(){return(await chrome.storage.local.get(o))[o]||null}())return!1;const e=(await chrome.storage.local.get(i))[i];if(e){let t=e;if(e<1e10&&(t=1e3*e),t<Date.now())return!1}return!0}async function U(e){try{await chrome.storage.local.set({[f]:e,[y]:Date.now()})}catch(e){console.error("[SafePlay Storage] Error setting user profile:",e)}}async function O(e){try{e?await chrome.storage.local.set({[g]:e}):await chrome.storage.local.remove(g)}catch(e){console.error("[SafePlay Storage] Error setting user subscription:",e)}}async function F(e){try{e?await chrome.storage.local.set({[p]:e}):await chrome.storage.local.remove(p)}catch(e){console.error("[SafePlay Storage] Error setting user credits:",e)}}async function N(){try{await chrome.storage.local.remove([o,n,i,c,l,u,d,f,g,p,y]),console.log("[SafePlay Storage] Auth data cleared")}catch(e){console.error("[SafePlay Storage] Error clearing auth data:",e)}}async function D(){const e=await S();return{isAuthenticated:null!==e,profile:await async function(){try{const e=await chrome.storage.local.get([f,y]),t=e[y],r=e[f];return t&&r&&Date.now()-t<6e5?r:null}catch(e){return console.error("[SafePlay Storage] Error getting user profile:",e),null}}(),subscription:await async function(){try{return(await chrome.storage.local.get(g))[g]||null}catch(e){return console.error("[SafePlay Storage] Error getting user subscription:",e),null}}(),credits:await async function(){try{return(await chrome.storage.local.get(p))[p]||null}catch(e){return console.error("[SafePlay Storage] Error getting user credits:",e),null}}(),token:e}}},574(e,t,r){r.d(t,{d:()=>s});const s={enabled:!0,filterMode:"mute",severityLevels:{mild:!1,moderate:!0,severe:!0,religious:!1},customBlacklist:[],customWhitelist:[],paddingMs:50,paddingBeforeMs:100,paddingAfterMs:30,mergeThresholdMs:100,autoEnableForFilteredVideos:!0}}},t={};function r(s){var a=t[s];if(void 0!==a)return a.exports;var o=t[s]={exports:{}};return e[s](o,o.exports,r),o.exports}r.d=(e,t)=>{for(var s in t)r.o(t,s)&&!r.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var s=r(167);function a(...e){console.log("[SafePlay API]",...e)}class o extends Error{constructor(e,t,r,s){super(e),this.statusCode=t,this.response=r,this.errorCode=s,this.name="ApiError"}}async function n(e,t={}){const{method:r="GET",body:i,requiresAuth:c=!0,_isRetry:l=!1}=t,u=`https://trysafeplay.com${e}`;a(`>>> ${r} ${u}`,i?JSON.stringify(i):"");const d={"Content-Type":"application/json"};if(c){const e=await(0,s.c4)();a("Auth token:",e?`${e.substring(0,20)}...`:"none"),e&&(d.Authorization=`Bearer ${e}`)}try{const h=await fetch(u,{method:r,headers:d,body:i?JSON.stringify(i):void 0});if(a(`<<< ${h.status} ${h.statusText}`),!h.ok){const r=await h.text();a("Error response body:",r);let i={};try{i=JSON.parse(r)}catch{i={rawError:r}}if(401===h.status&&c&&!l){if(a("Got 401, checking if refresh is possible..."),await(0,s.F3)()){if(a("Has refresh token, attempting token refresh..."),await(0,s.B3)())return a("Token refreshed, retrying request..."),n(e,{...t,_isRetry:!0})}else a("No refresh token stored - user is logged out, skipping refresh");throw a("Token refresh failed or skipped, clearing auth data and notifying UI"),await(0,s.m_)(),"undefined"!=typeof chrome&&chrome.tabs&&chrome.tabs.query({}).then(e=>{for(const t of e)t.id&&chrome.tabs.sendMessage(t.id,{type:"AUTH_STATE_CHANGED",payload:{isAuthenticated:!1}}).catch(()=>{})}),new o("Session expired. Please sign in again.",401,i,"SESSION_EXPIRED")}throw new o(i.message||i.error||`Request failed with status ${h.status}`,h.status,i,i.error_code)}const f=await h.json();return a("Response data:",JSON.stringify(f).substring(0,500)),f}catch(e){if(e instanceof o)throw e;const t=e instanceof Error?e.message:"Network error";throw a("Request failed:",t),new o(t,0,{networkError:!0,originalError:String(e)})}}async function i(){return a("=== getCreditBalance ==="),n("/api/credits/balance",{method:"GET",requiresAuth:!0})}async function c(e,t="mute",r){return a("=== startFilter ===",e,t),n("/api/filter/start",{method:"POST",body:{youtube_id:e,filter_type:t,custom_words:r},requiresAuth:!0})}async function l(e){a("=== recordCachedHistory ===",e.youtubeId);try{await n("/api/filter/record-history",{method:"POST",body:{youtube_id:e.youtubeId,title:e.title||null,channel_name:e.channelName||null,duration_seconds:e.durationSeconds||null,filter_type:e.filterType||"mute",custom_words:e.customWords||[]},requiresAuth:!0}),a("History recorded successfully for:",e.youtubeId)}catch(e){a("Failed to record history (non-critical):",e instanceof Error?e.message:e)}}function u(...e){console.log("[SafePlay BG]",...e)}function d(...e){console.error("[SafePlay BG ERROR]",...e)}function h(e){if(!e)return void chrome.action.setBadgeText({text:""});const{available:t}=e,r=t.toString();let s;chrome.action.setBadgeText({text:r}),s=0===t?"#F44336":t<=5?"#FF9800":"#4CAF50",chrome.action.setBadgeBackgroundColor({color:s})}function f(){chrome.action.setBadgeText({text:""})}async function g(){try{if(!await(0,s.c4)())return void f();const e=await i();e.success&&e.credits&&await(0,s.setCreditInfo)(e.credits)}catch{}}chrome.storage.onChanged.addListener((e,t)=>{"local"===t&&e.safeplay_credit_info&&h(e.safeplay_credit_info.newValue||null)}),chrome.storage.local.get("safeplay_credit_info").then(e=>{const t=e.safeplay_credit_info;t&&h(t)});const p="safeplay_credit_refresh";async function y(){try{const e=await i();e.success&&e.credits&&(await(0,s.setCreditInfo)(e.credits),u("Credits refreshed from API:",e.credits.available))}catch(e){u("Failed to refresh credits:",e)}}async function m(){u("handleLogout called"),await(0,s.m_)(),f();const e=await chrome.tabs.query({});for(const t of e)t.id&&chrome.tabs.sendMessage(t.id,{type:"AUTH_STATE_CHANGED",payload:{isAuthenticated:!1}}).catch(()=>{});return{success:!0}}chrome.alarms.create(p,{periodInMinutes:2}),chrome.alarms.onAlarm.addListener(async e=>{e.name===p&&await(0,s.c4)()&&(u("Alarm: refreshing credits"),await y())}),chrome.runtime.onMessage.addListener((e,t,r)=>(async function(e){u("Received message:",e.type);try{switch(e.type){case"GET_FILTER":return await async function(e){const{youtubeId:t}=e;u("handleGetFilter called with youtubeId:",t);const r=await(0,s.v_)(t);if(r)return u("Found in local cache, returning cached transcript"),l({youtubeId:t}).catch(()=>{}),{success:!0,data:{status:"cached",transcript:r}};u("Not in local cache, making API request...");try{u("Calling requestFilter API...");const e=await async function(e){a("=== requestFilter (legacy) ===",e);try{const t=await c(e);return{status:t.status,cached:t.cached,transcript:t.transcript,job_id:t.job_id,error:t.error,error_code:t.error_code}}catch(e){if(e instanceof o)return{status:"failed",error:e.message,error_code:e.errorCode};throw e}}(t);if(u("API response:",JSON.stringify(e).substring(0,200)),"completed"===e.status&&e.transcript){u("API returned completed/cached transcript, saving locally");const r=e.transcript;return u("Transcript structure:",{id:r.id,segmentCount:r.segments?.length,firstSegment:r.segments?.[0]?{text:r.segments[0].text,start_time:r.segments[0].start_time,end_time:r.segments[0].end_time}:null}),await(0,s.hD)(t,e.transcript),await y(),{success:!0,data:{status:"completed",transcript:e.transcript}}}return"processing"===e.status&&e.job_id?(u("API returned processing status, job_id:",e.job_id),{success:!0,data:{status:"processing",jobId:e.job_id}}):"failed"===e.status?(u("API returned failed status, error_code:",e.error_code),{success:!0,data:{status:"failed",error:e.error,error_code:e.error_code}}):(d("Unexpected API response:",e),{success:!1,error:"Unexpected API response: "+JSON.stringify(e)})}catch(e){return d("handleGetFilter error:",e),{success:!1,error:e instanceof Error?e.message:"Failed to request filter"}}}(e.payload);case"GET_PREVIEW":return await async function(e){const{youtubeId:t}=e;if(u("handleGetPreview called with youtubeId:",t),await(0,s.v_)(t)){u("Found in local cache, preview shows 0 cost");let e=0;const r=await(0,s.I4)();return r&&(e=r.available),{success:!0,data:{video:{youtube_id:t,title:"Cached Video",duration:0},creditCost:0,userCredits:e,hasSufficientCredits:!0,isCached:!0}}}u("Not in local cache, fetching preview from API...");try{const e=await async function(e){return a("=== getPreview ===",e),n("/api/filter/preview",{method:"POST",body:{youtube_id:e},requiresAuth:!0})}(t);if(u("Preview response:",JSON.stringify(e).substring(0,300)),e.error||e.error_code)return{success:!1,error:e.error||`Error: ${e.error_code}`,data:void 0};if(void 0!==e.user_credits){const t=await(0,s.I4)();t&&await(0,s.setCreditInfo)({...t,available:e.user_credits})}const r=0===e.credit_cost&&!e.cached&&!e.has_transcript;return{success:!0,data:{video:{youtube_id:e.youtube_id,title:e.title,duration:e.duration_seconds,thumbnail:e.thumbnail_url,channel:e.channel_name},creditCost:e.credit_cost,creditCostNote:e.credit_cost_note,creditCostUnknown:r,userCredits:e.user_credits,hasSufficientCredits:e.has_sufficient_credits,isCached:e.cached||e.has_transcript}}}catch(e){return d("handleGetPreview error:",e),{success:!1,error:e instanceof Error?e.message:"Failed to get preview"}}}(e.payload);case"START_FILTER":return await async function(e){const{youtubeId:t,filterType:r="mute",customWords:a}=e;u("handleStartFilter called:",{youtubeId:t,filterType:r});const o=await(0,s.v_)(t);if(o)return u("Found in local cache, returning cached transcript"),l({youtubeId:t,filterType:r,customWords:a}).catch(()=>{}),{success:!0,data:{status:"cached",transcript:o}};try{const e=await c(t,r,a);return u("Start filter response:",JSON.stringify(e).substring(0,300)),"failed"===e.status||e.error?{success:!0,data:{status:"failed",error:e.error,error_code:e.error_code}}:"completed"===e.status&&e.transcript?(u("API returned completed/cached transcript, saving locally"),await(0,s.hD)(t,e.transcript),await y(),{success:!0,data:{status:"completed",transcript:e.transcript}}):"processing"===e.status&&e.job_id?(u("API returned processing status, job_id:",e.job_id),{success:!0,data:{status:"processing",jobId:e.job_id}}):{success:!0,data:{status:"failed",error:e.error||"Unexpected response",error_code:e.error_code}}}catch(e){return d("handleStartFilter error:",e),{success:!1,error:e instanceof Error?e.message:"Failed to start filter"}}}(e.payload);case"CHECK_JOB":return await async function(e){const{jobId:t}=e;u("handleCheckJob called with jobId:",t);try{u("Calling checkJobStatus API...");const e=await async function(e){return a("=== checkJobStatus ===",e),n(`/api/filter/status/${e}`,{method:"GET",requiresAuth:!0})}(t);if(u("Job status response:",JSON.stringify(e).substring(0,300)),"completed"===e.status&&e.transcript){const t=e.video?.youtube_id||e.transcript.id;u("Job completed, caching transcript for:",t);const r=e.transcript;u("Job transcript structure:",{id:r.id,segmentCount:r.segments?.length,firstSegment:r.segments?.[0]?{text:r.segments[0].text,start_time:r.segments[0].start_time,end_time:r.segments[0].end_time}:null}),await(0,s.hD)(t,e.transcript),await y()}return{success:!0,data:e}}catch(e){return d("handleCheckJob error:",e),{success:!1,error:e instanceof Error?e.message:"Failed to check job status"}}}(e.payload);case"GET_CREDITS":return await async function(){u("handleGetCredits called");const e=await(0,s.I4)();if(e)return u("Returning cached credit info:",e),{success:!0,data:e};try{const e=await i();return u("Credit balance response:",JSON.stringify(e)),e.success?(await(0,s.setCreditInfo)(e.credits),{success:!0,data:e.credits}):{success:!1,error:e.error||"Failed to get credits"}}catch(e){return d("handleGetCredits error:",e),{success:!1,error:e instanceof Error?e.message:"Failed to get credits"}}}();case"GET_PREFERENCES":return await async function(){return{success:!0,data:await(0,s.lX)()}}();case"SET_PREFERENCES":return await async function(e){const t=await(0,s.dF)(e),r=await chrome.tabs.query({url:"*://www.youtube.com/*"});for(const e of r)e.id&&chrome.tabs.sendMessage(e.id,{type:"PREFERENCES_UPDATED",payload:t}).catch(()=>{});return{success:!0,data:t}}(e.payload);case"GET_AUTH_STATUS":return await async function(){const e=await(0,s.wR)();return{success:!0,data:{authenticated:e,token:e&&await(0,s.c4)()||void 0}}}();case"CHECK_AUTH_STRICT":return await async function(){if(await(0,s.TN)())return u("handleCheckAuthStrict: authenticated (token valid)"),{success:!0,data:{authenticated:!0}};u("handleCheckAuthStrict: strict check failed, attempting token refresh");const e=null!==await(0,s.c4)();return u("handleCheckAuthStrict after refresh:",e),{success:!0,data:{authenticated:e}}}();case"GET_USER_PROFILE":return await async function(){u("handleGetUserProfile called");const e=await(0,s.c4)();if(!e)return u("Not authenticated, returning empty auth state"),{success:!0,data:{isAuthenticated:!1,user:null,subscription:null,credits:null,token:null}};try{const t=await async function(){return a("=== getUserProfile ==="),n("/api/user/profile",{method:"GET",requiresAuth:!0})}();if(u("User profile response:",JSON.stringify(t).substring(0,300)),t.user&&await(0,s.setUserProfile)(t.user),t.subscription&&await(0,s.setUserSubscription)(t.subscription),t.credits){await(0,s.setUserCredits)(t.credits);const e=t.subscription?.plans?.name?.toLowerCase()||"free",r=t.subscription?.plans?.monthly_credits||30,a=t.credits.available_credits,o=t.credits.used_this_period;await(0,s.setCreditInfo)({available:a,used_this_period:o,plan_allocation:r,percent_consumed:r>0?o/r*100:0,plan:e})}return{success:!0,data:{isAuthenticated:!0,user:t.user,subscription:t.subscription,credits:t.credits,token:e}}}catch(e){if(d("handleGetUserProfile error:",e),e instanceof Error&&e.message.includes("401"))return u("Token invalid, clearing auth data"),await(0,s.m_)(),{success:!0,data:{isAuthenticated:!1,user:null,subscription:null,credits:null,token:null}};const t=await(0,s.rz)();return{success:!0,data:{isAuthenticated:t.isAuthenticated,user:t.profile,subscription:t.subscription,credits:t.credits,token:t.token}}}}();case"LOGOUT":return await m();case"OPEN_LOGIN":return await async function(){u("handleOpenLogin called");const e=chrome.runtime.id,t=`${w}/extension/auth?extensionId=${e}`;return await chrome.tabs.create({url:t}),{success:!0}}();case"CLEAR_CACHE":return await async function(){return await(0,s.D4)(),{success:!0}}();default:return{success:!1,error:"Unknown message type"}}}catch(e){const t=e instanceof Error?e.message:"Unknown error";return u("Message handler error:",t),{success:!1,error:t}}}(e).then(r),!0));const w="https://trysafeplay.com";chrome.action.onClicked.addListener(e=>{u("Extension icon clicked")}),chrome.runtime.onInstalled.addListener(async e=>{u("Extension installed/updated:",e.reason),await g()}),chrome.runtime.onStartup.addListener(async()=>{u("Browser started"),await g()}),chrome.runtime.onMessageExternal.addListener((e,t,s)=>{if(["https://trysafeplay.com","https://safeplay.app","http://localhost:3000"].includes(t.origin||"")){if("AUTH_TOKEN"===e.type)return u("Received AUTH_TOKEN from website"),u("Message token details:",{hasToken:!!e.token,tokenLength:e.token?.length,hasRefreshToken:!!e.refreshToken,refreshTokenLength:e.refreshToken?.length,refreshTokenPreview:e.refreshToken?`${String(e.refreshToken).substring(0,15)}...`:"none",hasExpiresAt:!!e.expiresAt,expiresAt:e.expiresAt,expiresAtType:typeof e.expiresAt,hasUserId:!!e.userId,userId:e.userId}),Promise.resolve().then(r.bind(r,167)).then(async({setAuthToken:t,setUserId:r,setSubscriptionTier:a,setCreditInfo:o,setUserProfile:n,setUserSubscription:i,setUserCredits:c})=>{try{await t(e.token,e.refreshToken,e.expiresAt),e.userId&&await r(e.userId),e.tier&&await a(e.tier),e.credits&&await o(e.credits),e.user&&await n(e.user),e.subscription&&await i(e.subscription),e.userCredits&&await c(e.userCredits);const l=await chrome.tabs.query({});for(const t of l)t.id&&chrome.tabs.sendMessage(t.id,{type:"AUTH_STATE_CHANGED",payload:{isAuthenticated:!0,user:e.user}}).catch(()=>{});u("Auth data stored successfully"),s({success:!0})}catch(e){d("Error storing auth data:",e),s({success:!1,error:"Failed to store auth data"})}}),!0;if("CREDIT_UPDATE"===e.type)return Promise.resolve().then(r.bind(r,167)).then(({setCreditInfo:t})=>{t(e.credits).then(()=>{chrome.tabs.query({}).then(t=>{for(const r of t)r.id&&chrome.tabs.sendMessage(r.id,{type:"CREDIT_UPDATE",payload:e.credits}).catch(()=>{})}),s({success:!0})})}),!0;if("LOGOUT"===e.type)return u("Received LOGOUT from website"),m().then(()=>{s({success:!0})}),!0}return!1}),u("SafePlay background service worker initialized")})();
//# sourceMappingURL=background.js.map