(()=>{"use strict";const e="data-safeplay-processed",t="safeplay-filter-btn";class s{constructor(e){this.observer=null,this.intersectionObserver=null,this.debounceTimer=null,this.processedContainers=new WeakSet,this.options=e}start(){this.log("Starting resilient injector"),this.injectButtons(),this.setupMutationObserver(),this.setupIntersectionObserver(),this.setupNavigationListener()}stop(){this.observer&&(this.observer.disconnect(),this.observer=null),this.intersectionObserver&&(this.intersectionObserver.disconnect(),this.intersectionObserver=null),this.log("Stopped resilient injector")}injectButtons(){const e=this.detectVideoContainers();this.log(`Found ${e.length} video containers`);for(const t of e)this.injectButton(t)}detectVideoContainers(){const e=[],t=new Set,s=document.querySelectorAll('a[href*="/watch?v="], a[href*="/shorts/"]');for(const i of s){const s=this.extractYoutubeId(i.href);if(!s)continue;const r=this.findContainerFromLink(i);!r||t.has(r)||this.isProcessed(r)||(t.add(r),e.push({element:r,youtubeId:s,thumbnail:this.findThumbnail(r)}))}const i=document.querySelectorAll('img[src*="ytimg.com"], img[src*="i.ytimg.com"]');for(const s of i){const i=this.findContainerFromThumbnail(s);if(!i||t.has(i)||this.isProcessed(i))continue;const r=i.querySelector('a[href*="/watch?v="], a[href*="/shorts/"]'),o=r?this.extractYoutubeId(r.href):null;o&&(t.add(i),e.push({element:i,youtubeId:o,thumbnail:s.closest('[class*="thumbnail"]')||s.parentElement}))}return e}extractYoutubeId(e){const t=e.match(/[?&]v=([a-zA-Z0-9_-]{11})/);if(t)return t[1];const s=e.match(/\/shorts\/([a-zA-Z0-9_-]{11})/);return s?s[1]:null}findContainerFromLink(e){let t=e,s=null;for(;t&&t!==document.body&&(this.looksLikeVideoContainer(t)&&(s=t),!this.isTooHighInDOM(t));)t=t.parentElement;return s}findContainerFromThumbnail(e){let t=e,s=null;for(;t&&t!==document.body&&(this.looksLikeVideoContainer(t)&&(s=t),!this.isTooHighInDOM(t));)t=t.parentElement;return s}looksLikeVideoContainer(e){const t=e.getBoundingClientRect();if(t.width<100||t.height<80)return!1;const s=e.className.toLowerCase(),i=e.tagName.toLowerCase(),r=["video","item","renderer","content","card","tile","entry"].some(e=>s.includes(e)||i.includes(e)),o=null!==e.querySelector('a[href*="/watch"], a[href*="/shorts"]'),n=null!==e.querySelector('img[src*="ytimg.com"]');return r||o&&n}isTooHighInDOM(e){const t=e.className.toLowerCase(),s=e.id.toLowerCase();return["page","content","main","body","app","root","feed","browse","results","grid","list"].some(e=>t.includes(e)||s.includes(e))}findThumbnail(e){const t=['[class*="thumbnail"]','[id*="thumbnail"]',"ytd-thumbnail",".ytd-thumbnail"];for(const s of t){const t=e.querySelector(s);if(t)return t}const s=e.querySelector('img[src*="ytimg.com"]');return s?.parentElement||null}isProcessed(s){return this.processedContainers.has(s)||s.hasAttribute(e)||null!==s.querySelector(`.${t}`)}injectButton(t){if(this.isProcessed(t.element))return;t.element.setAttribute(e,"true"),this.processedContainers.add(t.element);const s=this.createButton(t.youtubeId),i=t.thumbnail||t.element.firstElementChild;i?i.parentElement?.insertBefore(s,i.nextSibling):t.element.appendChild(s),this.log(`Injected button for video: ${t.youtubeId}`)}createButton(s){const i=document.createElement("button");return i.className=t,i.setAttribute("data-youtube-id",s),i.innerHTML='\n      <svg class="safeplay-icon" viewBox="0 0 24 24" fill="currentColor">\n        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>\n      </svg>\n      <span class="safeplay-text">SafePlay</span>\n    ',i.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation();const r=i.closest(`[${e}]`);this.options.onButtonClick(s,r)}),i}setupMutationObserver(){this.observer=new MutationObserver(e=>{let t=!1;for(const s of e){if(s.addedNodes.length>0)for(const e of s.addedNodes)if(e instanceof HTMLElement&&(e.querySelector?.('a[href*="/watch"], a[href*="/shorts"]')||e.querySelector?.('img[src*="ytimg.com"]'))){t=!0;break}if(t)break}t&&this.debouncedInject()}),this.observer.observe(document.body,{childList:!0,subtree:!0})}setupIntersectionObserver(){this.intersectionObserver=new IntersectionObserver(e=>{e.some(e=>e.isIntersecting&&!this.isProcessed(e.target))&&this.debouncedInject()},{rootMargin:"200px"}),document.querySelectorAll("ytd-video-renderer, ytd-grid-video-renderer, ytd-compact-video-renderer, ytd-rich-item-renderer").forEach(e=>{this.intersectionObserver?.observe(e)})}setupNavigationListener(){const e=history.pushState,t=history.replaceState;history.pushState=(...t)=>{e.apply(history,t),this.onNavigation()},history.replaceState=(...e)=>{t.apply(history,e),this.onNavigation()},window.addEventListener("popstate",()=>{this.onNavigation()}),document.addEventListener("yt-navigate-finish",()=>{this.onNavigation()})}onNavigation(){this.log("Navigation detected, re-injecting buttons"),setTimeout(()=>this.injectButtons(),500)}debouncedInject(){null!==this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=window.setTimeout(()=>{this.injectButtons(),this.debounceTimer=null},100)}log(...e){this.options.debug&&console.log("[SafePlay Injector]",...e)}}class i{constructor(e){this.video=null,this.muteIntervals=[],this.filterMode="mute",this.isActive=!1,this.checkIntervalId=null,this.isMuted=!1,this.audioContext=null,this.bleepOscillator=null,this.bleepGain=null,this.onMuteStart=e?.onMuteStart,this.onMuteEnd=e?.onMuteEnd}initialize(e,t,s="mute"){this.video=e,this.muteIntervals=t,this.filterMode=s,this.muteIntervals.sort((e,t)=>e.start-t.start),"bleep"===s&&this.initializeAudioContext()}initializeAudioContext(){try{this.audioContext=new AudioContext,this.bleepGain=this.audioContext.createGain(),this.bleepGain.gain.value=0,this.bleepGain.connect(this.audioContext.destination)}catch(e){console.error("[SafePlay] Failed to initialize audio context:",e)}}start(){!this.isActive&&this.video&&(this.isActive=!0,this.checkIntervalId=window.setInterval(()=>{this.checkCurrentTime()},10),console.log("[SafePlay] Audio filter started with",this.muteIntervals.length,"intervals"))}stop(){this.isActive&&(this.isActive=!1,null!==this.checkIntervalId&&(clearInterval(this.checkIntervalId),this.checkIntervalId=null),this.unmute(),this.bleepOscillator&&(this.bleepOscillator.stop(),this.bleepOscillator=null),this.audioContext&&(this.audioContext.close(),this.audioContext=null),console.log("[SafePlay] Audio filter stopped"))}checkCurrentTime(){if(!this.video||!this.isActive)return;const e=this.video.currentTime,t=this.findActiveInterval(e);t&&!this.isMuted?this.mute(t):!t&&this.isMuted&&this.unmute()}findActiveInterval(e){let t=0,s=this.muteIntervals.length-1;for(;t<=s;){const i=Math.floor((t+s)/2),r=this.muteIntervals[i];if(e>=r.start&&e<=r.end)return r;e<r.start?s=i-1:t=i+1}return null}mute(e){this.video&&(this.isMuted=!0,"mute"===this.filterMode?this.video.muted=!0:"bleep"===this.filterMode&&(this.video.muted=!0,this.startBleep()),this.onMuteStart&&this.onMuteStart(e))}unmute(){this.video&&(this.isMuted=!1,this.video.muted=!1,"bleep"===this.filterMode&&this.stopBleep(),this.onMuteEnd&&this.onMuteEnd())}startBleep(){this.audioContext&&this.bleepGain&&("suspended"===this.audioContext.state&&this.audioContext.resume(),this.bleepOscillator=this.audioContext.createOscillator(),this.bleepOscillator.type="sine",this.bleepOscillator.frequency.value=1e3,this.bleepOscillator.connect(this.bleepGain),this.bleepGain.gain.setValueAtTime(0,this.audioContext.currentTime),this.bleepGain.gain.linearRampToValueAtTime(.3,this.audioContext.currentTime+.01),this.bleepOscillator.start())}stopBleep(){this.audioContext&&this.bleepGain&&this.bleepOscillator&&(this.bleepGain.gain.linearRampToValueAtTime(0,this.audioContext.currentTime+.01),setTimeout(()=>{this.bleepOscillator&&(this.bleepOscillator.stop(),this.bleepOscillator.disconnect(),this.bleepOscillator=null)},20))}updateIntervals(e){this.muteIntervals=e,this.muteIntervals.sort((e,t)=>e.start-t.start)}updateMode(e){this.filterMode=e,"bleep"!==e||this.audioContext||this.initializeAudioContext()}getState(){return{isActive:this.isActive,isMuted:this.isMuted,intervalCount:this.muteIntervals.length,filterMode:this.filterMode}}isFiltering(){return this.isActive}getIntervals(){return[...this.muteIntervals]}}const r=new Map([{word:"fuck",severity:"severe"},{word:"fucking",severity:"severe"},{word:"fucked",severity:"severe"},{word:"fucker",severity:"severe"},{word:"fuckers",severity:"severe"},{word:"fucks",severity:"severe"},{word:"motherfucker",severity:"severe"},{word:"motherfucking",severity:"severe"},{word:"motherfuckers",severity:"severe"},{word:"cunt",severity:"severe"},{word:"cunts",severity:"severe"},{word:"nigger",severity:"severe"},{word:"niggers",severity:"severe"},{word:"nigga",severity:"severe"},{word:"niggas",severity:"severe"},{word:"faggot",severity:"severe"},{word:"faggots",severity:"severe"},{word:"fag",severity:"severe"},{word:"fags",severity:"severe"},{word:"retard",severity:"severe"},{word:"retarded",severity:"severe"},{word:"retards",severity:"severe"},{word:"shit",severity:"moderate"},{word:"shits",severity:"moderate"},{word:"shitty",severity:"moderate"},{word:"bullshit",severity:"moderate"},{word:"horseshit",severity:"moderate"},{word:"shithead",severity:"moderate"},{word:"shitheads",severity:"moderate"},{word:"ass",severity:"moderate"},{word:"asses",severity:"moderate"},{word:"asshole",severity:"moderate"},{word:"assholes",severity:"moderate"},{word:"bastard",severity:"moderate"},{word:"bastards",severity:"moderate"},{word:"bitch",severity:"moderate"},{word:"bitches",severity:"moderate"},{word:"bitchy",severity:"moderate"},{word:"cock",severity:"moderate"},{word:"cocks",severity:"moderate"},{word:"cocksucker",severity:"moderate"},{word:"cocksuckers",severity:"moderate"},{word:"dick",severity:"moderate"},{word:"dicks",severity:"moderate"},{word:"dickhead",severity:"moderate"},{word:"dickheads",severity:"moderate"},{word:"pussy",severity:"moderate"},{word:"pussies",severity:"moderate"},{word:"prick",severity:"moderate"},{word:"pricks",severity:"moderate"},{word:"slut",severity:"moderate"},{word:"sluts",severity:"moderate"},{word:"slutty",severity:"moderate"},{word:"whore",severity:"moderate"},{word:"whores",severity:"moderate"},{word:"twat",severity:"moderate"},{word:"twats",severity:"moderate"},{word:"wanker",severity:"moderate"},{word:"wankers",severity:"moderate"},{word:"bollocks",severity:"moderate"},{word:"damn",severity:"mild"},{word:"damned",severity:"mild"},{word:"dammit",severity:"mild"},{word:"goddamn",severity:"mild"},{word:"goddamnit",severity:"mild"},{word:"hell",severity:"mild"},{word:"crap",severity:"mild"},{word:"crappy",severity:"mild"},{word:"piss",severity:"mild"},{word:"pissed",severity:"mild"},{word:"pissing",severity:"mild"},{word:"suck",severity:"mild"},{word:"sucks",severity:"mild"},{word:"sucked",severity:"mild"},{word:"balls",severity:"mild"},{word:"butt",severity:"mild"},{word:"butthole",severity:"mild"},{word:"screw",severity:"mild"},{word:"screwed",severity:"mild"},{word:"douche",severity:"mild"},{word:"douchebag",severity:"mild"},{word:"douchebags",severity:"mild"}].map(e=>[e.word.toLowerCase(),e.severity]));function o(e){const t=[],s=e.toLowerCase();for(const[e,i]of r){let r=s.indexOf(e);for(;-1!==r;)t.push({word:e,severity:i,startIndex:r,endIndex:r+e.length}),r=s.indexOf(e,r+1)}t.sort((e,t)=>e.startIndex-t.startIndex);const i=[];for(const e of t){const t=i[i.length-1];!t||e.startIndex>=t.endIndex?i.push(e):e.endIndex-e.startIndex>t.endIndex-t.startIndex&&(i[i.length-1]=e)}return i}class n{constructor(e){this.preferences=e,this.customBlacklistMap=new Map(e.customBlacklist.map(e=>[e.toLowerCase(),"severe"])),this.customWhitelistSet=new Set(e.customWhitelist.map(e=>e.toLowerCase()))}shouldFilterSeverity(e){return this.preferences.severityLevels[e]}shouldFilterWord(e,t){const s=e.toLowerCase();return!this.customWhitelistSet.has(s)&&(!!this.customBlacklistMap.has(s)||this.shouldFilterSeverity(t))}getWordSeverity(e){const t=e.toLowerCase();return this.customBlacklistMap.has(t)?this.customBlacklistMap.get(t):r.get(t)||null}findProfanityMatches(e){const t=[];for(let s=0;s<e.length;s++){const i=e[s],r=i.text.toLowerCase().trim(),n=this.getWordSeverity(r);if(n&&this.shouldFilterWord(r,n)){t.push({segmentIndex:s,word:i.text,severity:n,startTime:i.start_time,endTime:i.end_time,isPartialMatch:!1});continue}const a=o(r);for(const[e]of this.customBlacklistMap){const t=r.indexOf(e);-1!==t&&a.push({word:e,severity:"severe",startIndex:t,endIndex:t+e.length})}for(const e of a){if(!this.shouldFilterWord(e.word,e.severity))continue;let r=i.start_time,o=i.end_time;if(i.characters&&i.characters.length>0){const t=i.characters[e.startIndex],s=i.characters[e.endIndex-1];t&&(r=t.start_time),s&&(o=s.end_time)}t.push({segmentIndex:s,word:e.word,severity:e.severity,startTime:r,endTime:o,isPartialMatch:!0,matchedPortion:i.text.substring(e.startIndex,e.endIndex)})}}return t}createMuteIntervals(e){const t=this.preferences.paddingMs/1e3;return e.map(e=>({start:Math.max(0,e.startTime-t),end:e.endTime+t,word:e.word,severity:e.severity}))}mergeIntervals(e){if(0===e.length)return[];const t=[...e].sort((e,t)=>e.start-t.start),s=this.preferences.mergeThresholdMs/1e3,i=[t[0]];for(let e=1;e<t.length;e++){const r=t[e],o=i[i.length-1];r.start<=o.end+s?(o.end=Math.max(o.end,r.end),this.severityRank(r.severity)>this.severityRank(o.severity)&&(o.severity=r.severity),o.word.includes(r.word)||(o.word=`${o.word}, ${r.word}`)):i.push({...r})}return i}severityRank(e){return{mild:1,moderate:2,severe:3}[e]}parse(e){const t=this.findProfanityMatches(e.segments),s=this.createMuteIntervals(t);return this.mergeIntervals(s)}}function a(e,t){return new n(t).parse(e)}class d{constructor(e={}){this.youtubeId=null,this.video=null,this.transcript=null,this.muteIntervals=[],this.preferences=null,this.status="idle",this.progress=0,this.statusOverlay=null,this.options=e,this.audioFilter=new i({onMuteStart:e=>this.onMuteStart(e),onMuteEnd:()=>this.onMuteEnd()})}async initialize(e,t){this.youtubeId=e,this.preferences=t,this.updateStatus("idle"),this.video=this.findVideoElement(),this.video||(this.log("Video element not found, waiting..."),await this.waitForVideo()),this.video?this.log("Video controller initialized for:",e):this.updateStatus("error",0,"Could not find video element")}async applyFilter(){if(this.youtubeId&&this.video&&this.preferences)if(this.preferences.enabled)try{this.updateStatus("loading");const e=await chrome.runtime.sendMessage({type:"GET_FILTER",payload:{youtubeId:this.youtubeId}});if(!e.success)throw new Error(e.error||"Failed to get transcript");if("processing"===e.data.status)return void this.updateStatus("processing",e.data.progress||0);this.transcript=e.data.transcript,await this.processTranscript()}catch(e){const t=e instanceof Error?e.message:"Unknown error";this.updateStatus("error",0,t),this.log("Filter error:",e)}else this.updateStatus("disabled");else this.log("Cannot apply filter: missing required data")}async processTranscript(){if(this.transcript&&this.preferences&&this.video){if(this.muteIntervals=a(this.transcript,this.preferences),this.log("Found",this.muteIntervals.length,"mute intervals"),0===this.muteIntervals.length)return this.updateStatus("active"),void this.log("No profanity detected in video");this.audioFilter.initialize(this.video,this.muteIntervals,this.preferences.filterMode),this.audioFilter.start(),this.updateStatus("active"),this.showStatusOverlay()}}onTranscriptReceived(e){this.transcript=e,this.processTranscript()}onProcessingProgress(e){this.updateStatus("processing",e)}onProcessingError(e){this.updateStatus("error",0,e)}stop(){this.audioFilter.stop(),this.hideStatusOverlay(),this.updateStatus("idle")}updatePreferences(e){this.preferences=e,e.enabled?this.transcript&&(this.muteIntervals=a(this.transcript,e),this.audioFilter.updateIntervals(this.muteIntervals),this.audioFilter.updateMode(e.filterMode)):this.stop()}getState(){const e=this.audioFilter.getState();return{status:this.status,progress:this.progress,error:this.error,intervalCount:e.intervalCount,currentlyMuting:e.isMuted}}findVideoElement(){const e=["video.html5-main-video","video.video-stream","#movie_player video","ytd-player video","video"];for(const t of e){const e=document.querySelector(t);if(e&&e.src)return e}return null}waitForVideo(e=1e4){return new Promise(t=>{const s=Date.now(),i=()=>{this.video=this.findVideoElement(),this.video?t(this.video):Date.now()-s>e?t(null):requestAnimationFrame(i)};i()})}updateStatus(e,t=0,s){this.status=e,this.progress=t,this.error=s,this.options.onStateChange&&this.options.onStateChange(this.getState())}showStatusOverlay(){if(this.statusOverlay)return;const e=document.querySelector("#movie_player");e&&(this.statusOverlay=document.createElement("div"),this.statusOverlay.className="safeplay-status-overlay",this.statusOverlay.innerHTML='\n      <div class="safeplay-status-badge">\n        <svg class="safeplay-status-icon" viewBox="0 0 24 24" fill="currentColor">\n          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>\n        </svg>\n        <span>SafePlay Active</span>\n      </div>\n    ',e.appendChild(this.statusOverlay),setTimeout(()=>{this.statusOverlay?.classList.add("safeplay-status-hidden")},3e3))}hideStatusOverlay(){this.statusOverlay&&(this.statusOverlay.remove(),this.statusOverlay=null)}onMuteStart(e){this.log("Muting:",e.word),this.notifyStateChange()}onMuteEnd(){this.notifyStateChange()}notifyStateChange(){this.options.onStateChange&&this.options.onStateChange(this.getState())}log(...e){this.options.debug&&console.log("[SafePlay Controller]",...e)}}const l={enabled:!0,filterMode:"mute",severityLevels:{mild:!1,moderate:!0,severe:!0},customBlacklist:[],customWhitelist:[],paddingMs:50,mergeThresholdMs:100},c=!0;function h(...e){console.log("[SafePlay]",...e)}class u{constructor(){this.videoController=null,this.preferences=l,this.currentVideoId=null,this.injector=new s({onButtonClick:(e,t)=>this.onFilterButtonClick(e,t),debug:c}),this.videoController=new d({onStateChange:e=>this.onVideoStateChange(e),debug:c})}async initialize(){h("Initializing SafePlay content script"),await this.loadPreferences(),this.injector.start(),this.isWatchPage()&&await this.handleWatchPage(),this.setupMessageListener(),this.setupNavigationListener(),h("SafePlay initialized")}async loadPreferences(){try{const e=await chrome.runtime.sendMessage({type:"GET_PREFERENCES"});e.success&&e.data&&(this.preferences=e.data)}catch(e){h("Failed to load preferences:",e)}}isWatchPage(){return"/watch"===window.location.pathname}getVideoIdFromUrl(){return new URLSearchParams(window.location.search).get("v")}async handleWatchPage(){const e=this.getVideoIdFromUrl();e&&e!==this.currentVideoId&&(this.currentVideoId=e,h("Watch page detected, video ID:",e),this.injectPlayerControls(),this.preferences.enabled&&await this.startFiltering(e))}async startFiltering(e){this.videoController&&(await this.videoController.initialize(e,this.preferences),await this.videoController.applyFilter())}injectPlayerControls(){if(document.querySelector(".safeplay-player-controls"))return;const e=()=>{const t=document.querySelector(".ytp-right-controls");t?this.createPlayerButton(t):setTimeout(e,500)};e()}createPlayerButton(e){const t=document.createElement("button");t.className="ytp-button safeplay-player-controls",t.title="SafePlay Filter",t.innerHTML='\n      <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24">\n        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>\n      </svg>\n    ',t.addEventListener("click",()=>this.toggleFilter());const s=e.querySelector(".ytp-settings-button");s?e.insertBefore(t,s):e.appendChild(t),this.updatePlayerButtonState()}updatePlayerButtonState(){const e=document.querySelector(".safeplay-player-controls");if(!e)return;const t=this.videoController?.getState(),s="active"===t?.status;e.classList.toggle("safeplay-active",s),e.setAttribute("title",s?"SafePlay Active":"SafePlay Inactive")}async toggleFilter(){this.videoController&&("active"===this.videoController.getState().status?this.videoController.stop():this.currentVideoId&&await this.startFiltering(this.currentVideoId),this.updatePlayerButtonState())}onFilterButtonClick(e,t){h("Filter button clicked for:",e);const s=t.querySelector(".safeplay-filter-btn");s&&s.classList.add("safeplay-loading"),window.location.href=`https://www.youtube.com/watch?v=${e}`}onVideoStateChange(e){h("Video state changed:",e),this.updatePlayerButtonState(),chrome.runtime.sendMessage({type:"VIDEO_STATE_CHANGED",payload:e}).catch(()=>{})}setupMessageListener(){chrome.runtime.onMessage.addListener((e,t,s)=>(this.handleMessage(e).then(s),!0))}async handleMessage(e){switch(e.type){case"PREFERENCES_UPDATED":{const t=e.payload;return this.preferences=t,this.videoController?.updatePreferences(t),{success:!0}}case"TRANSCRIPT_RECEIVED":{const t=e.payload;return this.videoController?.onTranscriptReceived(t.transcript),{success:!0}}case"PROCESSING_PROGRESS":{const t=e.payload.progress;return this.videoController?.onProcessingProgress(t),{success:!0}}case"PROCESSING_ERROR":{const t=e.payload.error;return this.videoController?.onProcessingError(t),{success:!0}}case"GET_VIDEO_STATE":return{success:!0,data:this.videoController?.getState()||null};default:return{success:!1,error:"Unknown message type"}}}setupNavigationListener(){document.addEventListener("yt-navigate-finish",()=>{h("YouTube navigation detected"),this.onNavigation()}),window.addEventListener("popstate",()=>{this.onNavigation()})}onNavigation(){this.videoController&&this.videoController.stop(),setTimeout(()=>{this.injector.injectButtons()},500),this.isWatchPage()?setTimeout(()=>{this.handleWatchPage()},1e3):this.currentVideoId=null}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{(new u).initialize()}):(new u).initialize()})();
//# sourceMappingURL=content.js.map