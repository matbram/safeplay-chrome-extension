(()=>{"use strict";const t="safeplay-video-page-button-container";class e{constructor(t){this.observer=null,this.currentVideoId=null,this.injectionAttempts=0,this.maxAttempts=50,this.retryInterval=null,this.options=t}start(){this.log("Starting video page injector"),this.isWatchPage()||this.log("Not a watch page, waiting for navigation"),this.attemptInjection(),this.setupMutationObserver(),this.setupNavigationListener()}stop(){this.observer&&(this.observer.disconnect(),this.observer=null),null!==this.retryInterval&&(clearInterval(this.retryInterval),this.retryInterval=null),this.log("Stopped video page injector")}isWatchPage(){return"/watch"===window.location.pathname&&window.location.search.includes("v=")}getVideoId(){return new URLSearchParams(window.location.search).get("v")}attemptInjection(){if(!this.isWatchPage())return;const t=this.getVideoId();if(!t)return void this.log("No video ID found");if(this.currentVideoId===t&&this.isButtonPresent())return void this.log("Button already present for this video");const e=this.findSubscribeButton();e?(this.injectButton(e,t),this.currentVideoId=t,this.injectionAttempts=0,null!==this.retryInterval&&(clearInterval(this.retryInterval),this.retryInterval=null)):(this.injectionAttempts++,this.log(`Subscribe button not found, attempt ${this.injectionAttempts}/${this.maxAttempts}`),this.injectionAttempts<this.maxAttempts&&null===this.retryInterval&&(this.retryInterval=window.setInterval(()=>{this.attemptInjection()},200)))}findSubscribeButton(){const t=["#subscribe-button.ytd-watch-metadata","ytd-watch-metadata #subscribe-button","#owner #subscribe-button","#subscribe-button"];for(const e of t){const t=document.querySelector(e);if(t)return this.log(`Found subscribe button with selector: ${e}`),t}return null}isButtonPresent(){return null!==document.querySelector(`.${t}`)}injectButton(e,s){const i=document.querySelector(`.${t}`);i&&i.remove();const r=document.createElement("div");r.className=`${t} style-scope ytd-watch-metadata`,r.style.cssText="display: inline-block; margin-left: 8px;",r.setAttribute("data-safeplay-processed","true");const o=document.createElement("button");o.className="yt-spec-button-shape-next yt-spec-button-shape-next--tonal yt-spec-button-shape-next--mono yt-spec-button-shape-next--size-m yt-spec-button-shape-next--icon-leading yt-spec-button-shape-next--enable-backdrop-filter-experiment",o.title="Filter profanity with SafePlay",o.setAttribute("aria-label","SafePlay Filter"),o.style.cssText='\n      border: 1px solid var(--yt-spec-outline);\n      background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);\n      color: #ffffff;\n      border-radius: 18px;\n      padding: 0 16px;\n      height: 36px;\n      font-family: "Roboto", "Arial", sans-serif;\n      font-size: 14px;\n      font-weight: 500;\n      line-height: 36px;\n      display: inline-flex;\n      align-items: center;\n      justify-content: center;\n      gap: 6px;\n      cursor: pointer;\n      transition: all 0.2s ease;\n      min-width: 110px;\n      box-shadow: 0 1px 3px rgba(76, 175, 80, 0.3);\n    ';const n=document.createElement("div");n.style.cssText="display: inline-block; width: 20px; height: 20px; vertical-align: middle; flex-shrink: 0;",n.innerHTML='\n      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">\n        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>\n      </svg>\n    ';const a=document.createElement("span");a.style.cssText="color: currentColor; font-size: 14px; font-weight: 500; line-height: 1;",a.textContent="SafePlay",o.appendChild(n),o.appendChild(a),o.addEventListener("mouseenter",()=>{o.style.background="linear-gradient(135deg, #45a049 0%, #3d8b40 100%)",o.style.boxShadow="0 2px 6px rgba(76, 175, 80, 0.4)",o.style.transform="translateY(-1px)"}),o.addEventListener("mouseleave",()=>{o.style.background="linear-gradient(135deg, #4CAF50 0%, #45a049 100%)",o.style.boxShadow="0 1px 3px rgba(76, 175, 80, 0.3)",o.style.transform="translateY(0)"}),o.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),this.options.onButtonClick(s)}),r.appendChild(o),e.parentElement?.insertBefore(r,e.nextSibling),this.log(`Injected SafePlay button for video: ${s}`)}updateButtonState(e,s){const i=document.querySelector(`.${t}`);if(!i)return;const r=i.querySelector("button"),o=i.querySelector("span");if(r&&o)switch(e){case"loading":r.style.background="linear-gradient(135deg, #888 0%, #666 100%)",r.style.cursor="wait",o.textContent=s||"Loading...";break;case"active":r.style.background="linear-gradient(135deg, #2196F3 0%, #1976D2 100%)",r.style.boxShadow="0 1px 3px rgba(33, 150, 243, 0.3)",r.style.cursor="pointer",o.textContent=s||"Filtering";break;case"error":r.style.background="linear-gradient(135deg, #f44336 0%, #d32f2f 100%)",r.style.boxShadow="0 1px 3px rgba(244, 67, 54, 0.3)",r.style.cursor="pointer",o.textContent=s||"Error";break;default:r.style.background="linear-gradient(135deg, #4CAF50 0%, #45a049 100%)",r.style.boxShadow="0 1px 3px rgba(76, 175, 80, 0.3)",r.style.cursor="pointer",o.textContent="SafePlay"}}setupMutationObserver(){this.observer=new MutationObserver(t=>{for(const e of t)if("childList"===e.type&&e.addedNodes.length>0)for(const t of e.addedNodes)if(t instanceof HTMLElement&&("subscribe-button"===t.id||t.querySelector?.("#subscribe-button")||t.closest?.("ytd-watch-metadata")))return this.log("Subscribe button area changed, re-injecting"),void this.attemptInjection()}),this.observer.observe(document.body,{childList:!0,subtree:!0})}setupNavigationListener(){const t=history.pushState,e=history.replaceState;history.pushState=(...e)=>{t.apply(history,e),this.onNavigation()},history.replaceState=(...t)=>{e.apply(history,t),this.onNavigation()},window.addEventListener("popstate",()=>{this.onNavigation()}),document.addEventListener("yt-navigate-finish",()=>{this.onNavigation()}),document.addEventListener("yt-page-data-updated",()=>{this.log("Page data updated"),this.onNavigation()})}onNavigation(){this.log("Navigation detected"),this.currentVideoId=null,this.injectionAttempts=0,null!==this.retryInterval&&(clearInterval(this.retryInterval),this.retryInterval=null),setTimeout(()=>{this.attemptInjection()},300)}log(...t){this.options.debug&&console.log("[SafePlay Injector]",...t)}}class s{constructor(t){this.video=null,this.muteIntervals=[],this.filterMode="mute",this.isActive=!1,this.checkIntervalId=null,this.isMuted=!1,this.audioContext=null,this.bleepOscillator=null,this.bleepGain=null,this.onMuteStart=t?.onMuteStart,this.onMuteEnd=t?.onMuteEnd}initialize(t,e,s="mute"){this.video=t,this.muteIntervals=e,this.filterMode=s,this.muteIntervals.sort((t,e)=>t.start-e.start),"bleep"===s&&this.initializeAudioContext()}initializeAudioContext(){try{this.audioContext=new AudioContext,this.bleepGain=this.audioContext.createGain(),this.bleepGain.gain.value=0,this.bleepGain.connect(this.audioContext.destination)}catch(t){console.error("[SafePlay] Failed to initialize audio context:",t)}}start(){!this.isActive&&this.video&&(this.isActive=!0,this.checkIntervalId=window.setInterval(()=>{this.checkCurrentTime()},10),console.log("[SafePlay] Audio filter started with",this.muteIntervals.length,"intervals"))}stop(){this.isActive&&(this.isActive=!1,null!==this.checkIntervalId&&(clearInterval(this.checkIntervalId),this.checkIntervalId=null),this.unmute(),this.bleepOscillator&&(this.bleepOscillator.stop(),this.bleepOscillator=null),this.audioContext&&(this.audioContext.close(),this.audioContext=null),console.log("[SafePlay] Audio filter stopped"))}checkCurrentTime(){if(!this.video||!this.isActive)return;const t=this.video.currentTime,e=this.findActiveInterval(t);e&&!this.isMuted?this.mute(e):!e&&this.isMuted&&this.unmute()}findActiveInterval(t){let e=0,s=this.muteIntervals.length-1;for(;e<=s;){const i=Math.floor((e+s)/2),r=this.muteIntervals[i];if(t>=r.start&&t<=r.end)return r;t<r.start?s=i-1:e=i+1}return null}mute(t){this.video&&(this.isMuted=!0,"mute"===this.filterMode?this.video.muted=!0:"bleep"===this.filterMode&&(this.video.muted=!0,this.startBleep()),this.onMuteStart&&this.onMuteStart(t))}unmute(){this.video&&(this.isMuted=!1,this.video.muted=!1,"bleep"===this.filterMode&&this.stopBleep(),this.onMuteEnd&&this.onMuteEnd())}startBleep(){this.audioContext&&this.bleepGain&&("suspended"===this.audioContext.state&&this.audioContext.resume(),this.bleepOscillator=this.audioContext.createOscillator(),this.bleepOscillator.type="sine",this.bleepOscillator.frequency.value=1e3,this.bleepOscillator.connect(this.bleepGain),this.bleepGain.gain.setValueAtTime(0,this.audioContext.currentTime),this.bleepGain.gain.linearRampToValueAtTime(.3,this.audioContext.currentTime+.01),this.bleepOscillator.start())}stopBleep(){this.audioContext&&this.bleepGain&&this.bleepOscillator&&(this.bleepGain.gain.linearRampToValueAtTime(0,this.audioContext.currentTime+.01),setTimeout(()=>{this.bleepOscillator&&(this.bleepOscillator.stop(),this.bleepOscillator.disconnect(),this.bleepOscillator=null)},20))}updateIntervals(t){this.muteIntervals=t,this.muteIntervals.sort((t,e)=>t.start-e.start)}updateMode(t){this.filterMode=t,"bleep"!==t||this.audioContext||this.initializeAudioContext()}getState(){return{isActive:this.isActive,isMuted:this.isMuted,intervalCount:this.muteIntervals.length,filterMode:this.filterMode}}isFiltering(){return this.isActive}getIntervals(){return[...this.muteIntervals]}}const i=new Map([{word:"fuck",severity:"severe"},{word:"fucking",severity:"severe"},{word:"fucked",severity:"severe"},{word:"fucker",severity:"severe"},{word:"fuckers",severity:"severe"},{word:"fucks",severity:"severe"},{word:"motherfucker",severity:"severe"},{word:"motherfucking",severity:"severe"},{word:"motherfuckers",severity:"severe"},{word:"cunt",severity:"severe"},{word:"cunts",severity:"severe"},{word:"nigger",severity:"severe"},{word:"niggers",severity:"severe"},{word:"nigga",severity:"severe"},{word:"niggas",severity:"severe"},{word:"faggot",severity:"severe"},{word:"faggots",severity:"severe"},{word:"fag",severity:"severe"},{word:"fags",severity:"severe"},{word:"retard",severity:"severe"},{word:"retarded",severity:"severe"},{word:"retards",severity:"severe"},{word:"shit",severity:"moderate"},{word:"shits",severity:"moderate"},{word:"shitty",severity:"moderate"},{word:"bullshit",severity:"moderate"},{word:"horseshit",severity:"moderate"},{word:"shithead",severity:"moderate"},{word:"shitheads",severity:"moderate"},{word:"ass",severity:"moderate"},{word:"asses",severity:"moderate"},{word:"asshole",severity:"moderate"},{word:"assholes",severity:"moderate"},{word:"bastard",severity:"moderate"},{word:"bastards",severity:"moderate"},{word:"bitch",severity:"moderate"},{word:"bitches",severity:"moderate"},{word:"bitchy",severity:"moderate"},{word:"cock",severity:"moderate"},{word:"cocks",severity:"moderate"},{word:"cocksucker",severity:"moderate"},{word:"cocksuckers",severity:"moderate"},{word:"dick",severity:"moderate"},{word:"dicks",severity:"moderate"},{word:"dickhead",severity:"moderate"},{word:"dickheads",severity:"moderate"},{word:"pussy",severity:"moderate"},{word:"pussies",severity:"moderate"},{word:"prick",severity:"moderate"},{word:"pricks",severity:"moderate"},{word:"slut",severity:"moderate"},{word:"sluts",severity:"moderate"},{word:"slutty",severity:"moderate"},{word:"whore",severity:"moderate"},{word:"whores",severity:"moderate"},{word:"twat",severity:"moderate"},{word:"twats",severity:"moderate"},{word:"wanker",severity:"moderate"},{word:"wankers",severity:"moderate"},{word:"bollocks",severity:"moderate"},{word:"damn",severity:"mild"},{word:"damned",severity:"mild"},{word:"dammit",severity:"mild"},{word:"goddamn",severity:"mild"},{word:"goddamnit",severity:"mild"},{word:"hell",severity:"mild"},{word:"crap",severity:"mild"},{word:"crappy",severity:"mild"},{word:"piss",severity:"mild"},{word:"pissed",severity:"mild"},{word:"pissing",severity:"mild"},{word:"suck",severity:"mild"},{word:"sucks",severity:"mild"},{word:"sucked",severity:"mild"},{word:"balls",severity:"mild"},{word:"butt",severity:"mild"},{word:"butthole",severity:"mild"},{word:"screw",severity:"mild"},{word:"screwed",severity:"mild"},{word:"douche",severity:"mild"},{word:"douchebag",severity:"mild"},{word:"douchebags",severity:"mild"}].map(t=>[t.word.toLowerCase(),t.severity]));function r(t){const e=[],s=t.toLowerCase();for(const[t,r]of i){let i=s.indexOf(t);for(;-1!==i;)e.push({word:t,severity:r,startIndex:i,endIndex:i+t.length}),i=s.indexOf(t,i+1)}e.sort((t,e)=>t.startIndex-e.startIndex);const r=[];for(const t of e){const e=r[r.length-1];!e||t.startIndex>=e.endIndex?r.push(t):t.endIndex-t.startIndex>e.endIndex-e.startIndex&&(r[r.length-1]=t)}return r}class o{constructor(t){this.preferences=t,this.customBlacklistMap=new Map(t.customBlacklist.map(t=>[t.toLowerCase(),"severe"])),this.customWhitelistSet=new Set(t.customWhitelist.map(t=>t.toLowerCase()))}shouldFilterSeverity(t){return this.preferences.severityLevels[t]}shouldFilterWord(t,e){const s=t.toLowerCase();return!this.customWhitelistSet.has(s)&&(!!this.customBlacklistMap.has(s)||this.shouldFilterSeverity(e))}getWordSeverity(t){const e=t.toLowerCase();return this.customBlacklistMap.has(e)?this.customBlacklistMap.get(e):i.get(e)||null}findProfanityMatches(t){const e=[];for(let s=0;s<t.length;s++){const i=t[s],o=i.text.toLowerCase().trim(),n=this.getWordSeverity(o);if(n&&this.shouldFilterWord(o,n)){e.push({segmentIndex:s,word:i.text,severity:n,startTime:i.start_time,endTime:i.end_time,isPartialMatch:!1});continue}const a=r(o);for(const[t]of this.customBlacklistMap){const e=o.indexOf(t);-1!==e&&a.push({word:t,severity:"severe",startIndex:e,endIndex:e+t.length})}for(const t of a){if(!this.shouldFilterWord(t.word,t.severity))continue;let r=i.start_time,o=i.end_time;if(i.characters&&i.characters.length>0){const e=i.characters[t.startIndex],s=i.characters[t.endIndex-1];e&&(r=e.start_time),s&&(o=s.end_time)}e.push({segmentIndex:s,word:t.word,severity:t.severity,startTime:r,endTime:o,isPartialMatch:!0,matchedPortion:i.text.substring(t.startIndex,t.endIndex)})}}return e}createMuteIntervals(t){const e=this.preferences.paddingMs/1e3;return t.map(t=>({start:Math.max(0,t.startTime-e),end:t.endTime+e,word:t.word,severity:t.severity}))}mergeIntervals(t){if(0===t.length)return[];const e=[...t].sort((t,e)=>t.start-e.start),s=this.preferences.mergeThresholdMs/1e3,i=[e[0]];for(let t=1;t<e.length;t++){const r=e[t],o=i[i.length-1];r.start<=o.end+s?(o.end=Math.max(o.end,r.end),this.severityRank(r.severity)>this.severityRank(o.severity)&&(o.severity=r.severity),o.word.includes(r.word)||(o.word=`${o.word}, ${r.word}`)):i.push({...r})}return i}severityRank(t){return{mild:1,moderate:2,severe:3}[t]}parse(t){const e=this.findProfanityMatches(t.segments),s=this.createMuteIntervals(e);return this.mergeIntervals(s)}}function n(t,e){return new o(e).parse(t)}class a{constructor(t={}){this.youtubeId=null,this.video=null,this.transcript=null,this.muteIntervals=[],this.preferences=null,this.status="idle",this.progress=0,this.statusOverlay=null,this.options=t,this.audioFilter=new s({onMuteStart:t=>this.onMuteStart(t),onMuteEnd:()=>this.onMuteEnd()})}async initialize(t,e){this.youtubeId=t,this.preferences=e,this.updateStatus("idle"),this.video=this.findVideoElement(),this.video||(this.log("Video element not found, waiting..."),await this.waitForVideo()),this.video?this.log("Video controller initialized for:",t):this.updateStatus("error",0,"Could not find video element")}async applyFilter(){if(this.youtubeId&&this.video&&this.preferences)if(this.preferences.enabled)try{this.updateStatus("loading");const t=await chrome.runtime.sendMessage({type:"GET_FILTER",payload:{youtubeId:this.youtubeId}});if(!t.success)throw new Error(t.error||"Failed to get transcript");if("processing"===t.data.status)return void this.updateStatus("processing",t.data.progress||0);this.transcript=t.data.transcript,await this.processTranscript()}catch(t){const e=t instanceof Error?t.message:"Unknown error";this.updateStatus("error",0,e),this.log("Filter error:",t)}else this.updateStatus("disabled");else this.log("Cannot apply filter: missing required data")}async processTranscript(){if(this.transcript&&this.preferences&&this.video){if(this.muteIntervals=n(this.transcript,this.preferences),this.log("Found",this.muteIntervals.length,"mute intervals"),0===this.muteIntervals.length)return this.updateStatus("active"),void this.log("No profanity detected in video");this.audioFilter.initialize(this.video,this.muteIntervals,this.preferences.filterMode),this.audioFilter.start(),this.updateStatus("active"),this.showStatusOverlay()}}onTranscriptReceived(t){this.transcript=t,this.processTranscript()}onProcessingProgress(t){this.updateStatus("processing",t)}onProcessingError(t){this.updateStatus("error",0,t)}stop(){this.audioFilter.stop(),this.hideStatusOverlay(),this.updateStatus("idle")}updatePreferences(t){this.preferences=t,t.enabled?this.transcript&&(this.muteIntervals=n(this.transcript,t),this.audioFilter.updateIntervals(this.muteIntervals),this.audioFilter.updateMode(t.filterMode)):this.stop()}getState(){const t=this.audioFilter.getState();return{status:this.status,progress:this.progress,error:this.error,intervalCount:t.intervalCount,currentlyMuting:t.isMuted}}findVideoElement(){const t=["video.html5-main-video","video.video-stream","#movie_player video","ytd-player video","video"];for(const e of t){const t=document.querySelector(e);if(t&&t.src)return t}return null}waitForVideo(t=1e4){return new Promise(e=>{const s=Date.now(),i=()=>{this.video=this.findVideoElement(),this.video?e(this.video):Date.now()-s>t?e(null):requestAnimationFrame(i)};i()})}updateStatus(t,e=0,s){this.status=t,this.progress=e,this.error=s,this.options.onStateChange&&this.options.onStateChange(this.getState())}showStatusOverlay(){if(this.statusOverlay)return;const t=document.querySelector("#movie_player");t&&(this.statusOverlay=document.createElement("div"),this.statusOverlay.className="safeplay-status-overlay",this.statusOverlay.innerHTML='\n      <div class="safeplay-status-badge">\n        <svg class="safeplay-status-icon" viewBox="0 0 24 24" fill="currentColor">\n          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>\n        </svg>\n        <span>SafePlay Active</span>\n      </div>\n    ',t.appendChild(this.statusOverlay),setTimeout(()=>{this.statusOverlay?.classList.add("safeplay-status-hidden")},3e3))}hideStatusOverlay(){this.statusOverlay&&(this.statusOverlay.remove(),this.statusOverlay=null)}onMuteStart(t){this.log("Muting:",t.word),this.notifyStateChange()}onMuteEnd(){this.notifyStateChange()}notifyStateChange(){this.options.onStateChange&&this.options.onStateChange(this.getState())}log(...t){this.options.debug&&console.log("[SafePlay Controller]",...t)}}const d={enabled:!0,filterMode:"mute",severityLevels:{mild:!1,moderate:!0,severe:!0},customBlacklist:[],customWhitelist:[],paddingMs:50,mergeThresholdMs:100},l=!0;function h(...t){console.log("[SafePlay]",...t)}class c{constructor(){this.videoController=null,this.preferences=d,this.currentVideoId=null,this.injector=new e({onButtonClick:t=>this.onFilterButtonClick(t),debug:l}),this.videoController=new a({onStateChange:t=>this.onVideoStateChange(t),debug:l})}async initialize(){h("Initializing SafePlay content script"),await this.loadPreferences(),this.injector.start(),this.isWatchPage()&&await this.handleWatchPage(),this.setupMessageListener(),this.setupNavigationListener(),h("SafePlay initialized")}async loadPreferences(){try{const t=await chrome.runtime.sendMessage({type:"GET_PREFERENCES"});t.success&&t.data&&(this.preferences=t.data)}catch(t){h("Failed to load preferences:",t)}}isWatchPage(){return"/watch"===window.location.pathname}getVideoIdFromUrl(){return new URLSearchParams(window.location.search).get("v")}async handleWatchPage(){const t=this.getVideoIdFromUrl();t&&t!==this.currentVideoId&&(this.currentVideoId=t,h("Watch page detected, video ID:",t),this.injectPlayerControls())}async startFiltering(t){if(this.videoController){this.injector.updateButtonState("loading","Loading...");try{await this.videoController.initialize(t,this.preferences),await this.videoController.applyFilter(),this.injector.updateButtonState("active","Filtering")}catch(t){h("Failed to start filtering:",t),this.injector.updateButtonState("error","Error")}}}injectPlayerControls(){if(document.querySelector(".safeplay-player-controls"))return;const t=()=>{const e=document.querySelector(".ytp-right-controls");e?this.createPlayerButton(e):setTimeout(t,500)};t()}createPlayerButton(t){const e=document.createElement("button");e.className="ytp-button safeplay-player-controls",e.title="SafePlay Filter",e.innerHTML='\n      <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24">\n        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>\n      </svg>\n    ',e.addEventListener("click",()=>this.toggleFilter());const s=t.querySelector(".ytp-settings-button");s?t.insertBefore(e,s):t.appendChild(e),this.updatePlayerButtonState()}updatePlayerButtonState(){const t=document.querySelector(".safeplay-player-controls");if(!t)return;const e=this.videoController?.getState(),s="active"===e?.status;t.classList.toggle("safeplay-active",s),t.setAttribute("title",s?"SafePlay Active":"SafePlay Inactive")}async toggleFilter(){this.videoController&&("active"===this.videoController.getState().status?(this.videoController.stop(),this.injector.updateButtonState("idle")):this.currentVideoId&&await this.startFiltering(this.currentVideoId),this.updatePlayerButtonState())}onFilterButtonClick(t){h("Filter button clicked for:",t),this.startFiltering(t)}onVideoStateChange(t){h("Video state changed:",t),this.updatePlayerButtonState(),"active"===t.status?this.injector.updateButtonState("active","Filtering"):"error"===t.status?this.injector.updateButtonState("error","Error"):"loading"===t.status?this.injector.updateButtonState("loading","Loading..."):this.injector.updateButtonState("idle"),chrome.runtime.sendMessage({type:"VIDEO_STATE_CHANGED",payload:t}).catch(()=>{})}setupMessageListener(){chrome.runtime.onMessage.addListener((t,e,s)=>(this.handleMessage(t).then(s),!0))}async handleMessage(t){switch(t.type){case"PREFERENCES_UPDATED":{const e=t.payload;return this.preferences=e,this.videoController?.updatePreferences(e),{success:!0}}case"TRANSCRIPT_RECEIVED":{const e=t.payload;return this.videoController?.onTranscriptReceived(e.transcript),{success:!0}}case"PROCESSING_PROGRESS":{const e=t.payload.progress;return this.videoController?.onProcessingProgress(e),{success:!0}}case"PROCESSING_ERROR":{const e=t.payload.error;return this.videoController?.onProcessingError(e),{success:!0}}case"GET_VIDEO_STATE":return{success:!0,data:this.videoController?.getState()||null};default:return{success:!1,error:"Unknown message type"}}}setupNavigationListener(){document.addEventListener("yt-navigate-finish",()=>{h("YouTube navigation detected"),this.onNavigation()}),window.addEventListener("popstate",()=>{this.onNavigation()})}onNavigation(){this.videoController&&this.videoController.stop(),this.currentVideoId=null,this.isWatchPage()&&setTimeout(()=>{this.handleWatchPage()},500)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{(new c).initialize()}):(new c).initialize()})();
//# sourceMappingURL=content.js.map