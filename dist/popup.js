(()=>{"use strict";const e={enabled:!0,filterMode:"mute",severityLevels:{mild:!1,moderate:!0,severe:!0,religious:!1},customBlacklist:[],customWhitelist:[],paddingMs:50,paddingBeforeMs:100,paddingAfterMs:30,mergeThresholdMs:100};class t{constructor(){this.preferences=e}async initialize(){this.enableToggle=document.getElementById("enableToggle"),this.filterModeRadios=document.querySelectorAll('input[name="filterMode"]'),this.severityMild=document.getElementById("severityMild"),this.severityModerate=document.getElementById("severityModerate"),this.severitySevere=document.getElementById("severitySevere"),this.severityReligious=document.getElementById("severityReligious"),this.statusBanner=document.getElementById("statusBanner"),this.statusText=document.getElementById("statusText"),this.videoStatusSection=document.getElementById("videoStatus"),this.videoStatusValue=document.getElementById("videoStatusValue"),this.filteredCount=document.getElementById("filteredCount"),this.progressBar=document.getElementById("progressBar"),this.progressFill=document.getElementById("progressFill"),await this.loadPreferences(),this.setupEventListeners(),await this.checkVideoStatus(),this.setupMessageListener()}async loadPreferences(){try{const e=await chrome.runtime.sendMessage({type:"GET_PREFERENCES"});e.success&&e.data&&(this.preferences=e.data,this.updateUI())}catch(e){console.error("Failed to load preferences:",e)}}updateUI(){this.enableToggle.checked=this.preferences.enabled,document.body.classList.toggle("disabled",!this.preferences.enabled),this.updateStatusBanner(),this.filterModeRadios.forEach(e=>{e.checked=e.value===this.preferences.filterMode}),this.severityMild.checked=this.preferences.severityLevels.mild,this.severityModerate.checked=this.preferences.severityLevels.moderate,this.severitySevere.checked=this.preferences.severityLevels.severe,this.severityReligious.checked=this.preferences.severityLevels.religious}updateStatusBanner(){this.statusBanner.classList.remove("inactive","error"),this.preferences.enabled?this.statusText.textContent="Protection Active":(this.statusBanner.classList.add("inactive"),this.statusText.textContent="Protection Disabled")}setupEventListeners(){this.enableToggle.addEventListener("change",()=>{this.savePreferences({enabled:this.enableToggle.checked})}),this.filterModeRadios.forEach(e=>{e.addEventListener("change",()=>{e.checked&&this.savePreferences({filterMode:e.value})})}),this.severityMild.addEventListener("change",()=>{this.saveSeverityLevels()}),this.severityModerate.addEventListener("change",()=>{this.saveSeverityLevels()}),this.severitySevere.addEventListener("change",()=>{this.saveSeverityLevels()}),this.severityReligious.addEventListener("change",()=>{this.saveSeverityLevels()});const e=document.getElementById("settingsLink");e?.addEventListener("click",e=>{e.preventDefault(),chrome.runtime.openOptionsPage?.()})}saveSeverityLevels(){this.savePreferences({severityLevels:{mild:this.severityMild.checked,moderate:this.severityModerate.checked,severe:this.severitySevere.checked,religious:this.severityReligious.checked}})}async savePreferences(e){try{const t=await chrome.runtime.sendMessage({type:"SET_PREFERENCES",payload:e});t.success&&t.data&&(this.preferences=t.data,this.updateUI())}catch(e){console.error("Failed to save preferences:",e)}}async checkVideoStatus(){try{const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!e?.id||!e.url?.includes("youtube.com/watch"))return void(this.videoStatusSection.style.display="none");const t=await chrome.tabs.sendMessage(e.id,{type:"GET_VIDEO_STATE"});t?.success&&t.data&&this.updateVideoStatus(t.data)}catch(e){this.videoStatusSection.style.display="none"}}updateVideoStatus(e){this.videoStatusSection.style.display="block",this.videoStatusValue.textContent={idle:"Ready",loading:"Loading...",processing:"Processing...",active:"Filtering",error:"Error",disabled:"Disabled"}[e.status]||e.status,"error"===e.status&&e.error&&(this.videoStatusValue.textContent=e.error,this.statusBanner.classList.add("error"),this.statusText.textContent="Error Occurred"),this.filteredCount.textContent=e.intervalCount.toString(),"processing"===e.status?(this.progressBar.style.display="block",this.progressFill.style.width=`${e.progress}%`):this.progressBar.style.display="none"}setupMessageListener(){chrome.runtime.onMessage.addListener(e=>{"VIDEO_STATE_CHANGED"===e.type&&e.payload&&this.updateVideoStatus(e.payload),"PREFERENCES_UPDATED"===e.type&&e.payload&&(this.preferences=e.payload,this.updateUI())})}}document.addEventListener("DOMContentLoaded",()=>{(new t).initialize()})})();
//# sourceMappingURL=popup.js.map