{"version":3,"file":"popup.js","mappings":"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","sources":["webpack://safeplay-chrome-extension/./src/types/index.ts","webpack://safeplay-chrome-extension/./src/popup/index.ts"],"sourcesContent":["// API Response Types\n\nexport interface CharacterTiming {\n  char: string;\n  start: number;\n  end: number;\n}\n\nexport interface TranscriptSegment {\n  text: string;\n  start_time: number;\n  end_time: number;\n  characters: CharacterTiming[];\n}\n\nexport interface Transcript {\n  id: string;\n  youtube_id?: string; // May be set from context\n  full_text?: string;\n  segments: TranscriptSegment[];\n  duration?: number;\n  language?: string;\n  created_at?: string;\n}\n\nexport interface FilterResponse {\n  status: 'completed' | 'processing';\n  cached?: boolean;\n  transcript?: Transcript;\n  job_id?: string;\n  message?: string;\n}\n\nexport interface JobStatusResponse {\n  status: 'pending' | 'downloading' | 'transcribing' | 'completed' | 'failed';\n  progress: number;\n  transcript?: Transcript;\n  error?: string;\n  video?: {\n    youtube_id: string;\n    title?: string;\n  };\n}\n\n// Button state for UX\nexport type ButtonState =\n  | 'idle'\n  | 'connecting'\n  | 'downloading'\n  | 'transcribing'\n  | 'processing'\n  | 'filtering'\n  | 'error';\n\nexport interface ButtonStateInfo {\n  state: ButtonState;\n  text: string;\n  progress?: number;\n  intervalCount?: number;\n  error?: string;\n}\n\n// Profanity Types\n\nexport type SeverityLevel = 'mild' | 'moderate' | 'severe';\n\nexport interface ProfanityWord {\n  word: string;\n  severity: SeverityLevel;\n}\n\nexport interface MuteInterval {\n  start: number;\n  end: number;\n  word: string;\n  severity: SeverityLevel;\n}\n\nexport interface ProfanityMatch {\n  segmentIndex: number;\n  word: string;\n  severity: SeverityLevel;\n  startTime: number;\n  endTime: number;\n  isPartialMatch: boolean;\n  matchedPortion?: string;\n}\n\n// User Preferences\n\nexport type FilterMode = 'mute' | 'bleep';\n\nexport interface UserPreferences {\n  enabled: boolean;\n  filterMode: FilterMode;\n  severityLevels: {\n    mild: boolean;\n    moderate: boolean;\n    severe: boolean;\n  };\n  customBlacklist: string[];\n  customWhitelist: string[];\n  paddingMs: number; // Legacy/fallback symmetric padding\n  paddingBeforeMs?: number; // Padding before word starts (catches attack)\n  paddingAfterMs?: number; // Padding after word ends (catches release)\n  mergeThresholdMs: number;\n}\n\nexport const DEFAULT_PREFERENCES: UserPreferences = {\n  enabled: true,\n  filterMode: 'mute',\n  severityLevels: {\n    mild: false,\n    moderate: true,\n    severe: true,\n  },\n  customBlacklist: [],\n  customWhitelist: [],\n  paddingMs: 50, // Legacy/fallback symmetric padding\n  paddingBeforeMs: 75, // Reduced - smooth fade adds ~90ms effective lead time\n  paddingAfterMs: 25, // Reduced - fade-in handles smooth transition\n  mergeThresholdMs: 100,\n};\n\n// Storage Types\n\nexport interface StorageData {\n  preferences: UserPreferences;\n  authToken?: string;\n  userId?: string;\n  subscriptionTier?: 'free' | 'basic' | 'professional' | 'unlimited';\n  cachedTranscripts: Record<string, Transcript>;\n}\n\n// Message Types (between content script and background)\n\nexport type MessageType =\n  | 'GET_FILTER'\n  | 'CHECK_JOB'\n  | 'GET_PREFERENCES'\n  | 'SET_PREFERENCES'\n  | 'GET_AUTH_STATUS'\n  | 'CLEAR_CACHE';\n\nexport interface Message<T = unknown> {\n  type: MessageType;\n  payload?: T;\n}\n\nexport interface MessageResponse<T = unknown> {\n  success: boolean;\n  data?: T;\n  error?: string;\n}\n","// SafePlay Popup Script\nimport { UserPreferences, DEFAULT_PREFERENCES, FilterMode } from '../types';\nimport './popup.css';\n\nclass PopupController {\n  private preferences: UserPreferences = DEFAULT_PREFERENCES;\n\n  // DOM Elements\n  private enableToggle!: HTMLInputElement;\n  private filterModeRadios!: NodeListOf<HTMLInputElement>;\n  private severityMild!: HTMLInputElement;\n  private severityModerate!: HTMLInputElement;\n  private severitySevere!: HTMLInputElement;\n  private statusIndicator!: HTMLElement;\n  private statusText!: HTMLElement;\n  private videoStatusSection!: HTMLElement;\n  private videoStatusValue!: HTMLElement;\n  private filteredCount!: HTMLElement;\n  private progressBar!: HTMLElement;\n  private progressFill!: HTMLElement;\n\n  async initialize(): Promise<void> {\n    // Get DOM elements\n    this.enableToggle = document.getElementById('enableToggle') as HTMLInputElement;\n    this.filterModeRadios = document.querySelectorAll('input[name=\"filterMode\"]');\n    this.severityMild = document.getElementById('severityMild') as HTMLInputElement;\n    this.severityModerate = document.getElementById('severityModerate') as HTMLInputElement;\n    this.severitySevere = document.getElementById('severitySevere') as HTMLInputElement;\n    this.statusIndicator = document.getElementById('statusIndicator') as HTMLElement;\n    this.statusText = this.statusIndicator.querySelector('.status-text') as HTMLElement;\n    this.videoStatusSection = document.getElementById('videoStatus') as HTMLElement;\n    this.videoStatusValue = document.getElementById('videoStatusValue') as HTMLElement;\n    this.filteredCount = document.getElementById('filteredCount') as HTMLElement;\n    this.progressBar = document.getElementById('progressBar') as HTMLElement;\n    this.progressFill = document.getElementById('progressFill') as HTMLElement;\n\n    // Load preferences\n    await this.loadPreferences();\n\n    // Set up event listeners\n    this.setupEventListeners();\n\n    // Check current video status\n    await this.checkVideoStatus();\n\n    // Listen for status updates\n    this.setupMessageListener();\n  }\n\n  private async loadPreferences(): Promise<void> {\n    try {\n      const response = await chrome.runtime.sendMessage({ type: 'GET_PREFERENCES' });\n      if (response.success && response.data) {\n        this.preferences = response.data;\n        this.updateUI();\n      }\n    } catch (error) {\n      console.error('Failed to load preferences:', error);\n    }\n  }\n\n  private updateUI(): void {\n    // Update toggle\n    this.enableToggle.checked = this.preferences.enabled;\n    document.body.classList.toggle('disabled', !this.preferences.enabled);\n\n    // Update status indicator\n    this.updateStatusIndicator();\n\n    // Update filter mode\n    this.filterModeRadios.forEach((radio) => {\n      radio.checked = radio.value === this.preferences.filterMode;\n    });\n\n    // Update severity checkboxes\n    this.severityMild.checked = this.preferences.severityLevels.mild;\n    this.severityModerate.checked = this.preferences.severityLevels.moderate;\n    this.severitySevere.checked = this.preferences.severityLevels.severe;\n  }\n\n  private updateStatusIndicator(): void {\n    this.statusIndicator.classList.remove('inactive', 'error');\n\n    if (!this.preferences.enabled) {\n      this.statusIndicator.classList.add('inactive');\n      this.statusText.textContent = 'Disabled';\n    } else {\n      this.statusText.textContent = 'Active';\n    }\n  }\n\n  private setupEventListeners(): void {\n    // Enable toggle\n    this.enableToggle.addEventListener('change', () => {\n      this.savePreferences({ enabled: this.enableToggle.checked });\n    });\n\n    // Filter mode\n    this.filterModeRadios.forEach((radio) => {\n      radio.addEventListener('change', () => {\n        if (radio.checked) {\n          this.savePreferences({ filterMode: radio.value as FilterMode });\n        }\n      });\n    });\n\n    // Severity levels\n    this.severityMild.addEventListener('change', () => {\n      this.saveSeverityLevels();\n    });\n\n    this.severityModerate.addEventListener('change', () => {\n      this.saveSeverityLevels();\n    });\n\n    this.severitySevere.addEventListener('change', () => {\n      this.saveSeverityLevels();\n    });\n\n    // Settings link\n    const settingsLink = document.getElementById('settingsLink');\n    settingsLink?.addEventListener('click', (e) => {\n      e.preventDefault();\n      // TODO: Open options page when implemented\n      chrome.runtime.openOptionsPage?.();\n    });\n  }\n\n  private saveSeverityLevels(): void {\n    this.savePreferences({\n      severityLevels: {\n        mild: this.severityMild.checked,\n        moderate: this.severityModerate.checked,\n        severe: this.severitySevere.checked,\n      },\n    });\n  }\n\n  private async savePreferences(updates: Partial<UserPreferences>): Promise<void> {\n    try {\n      const response = await chrome.runtime.sendMessage({\n        type: 'SET_PREFERENCES',\n        payload: updates,\n      });\n\n      if (response.success && response.data) {\n        this.preferences = response.data;\n        this.updateUI();\n      }\n    } catch (error) {\n      console.error('Failed to save preferences:', error);\n    }\n  }\n\n  private async checkVideoStatus(): Promise<void> {\n    try {\n      // Get current active tab\n      const [tab] = await chrome.tabs.query({ active: true, currentWindow: true });\n\n      if (!tab?.id || !tab.url?.includes('youtube.com/watch')) {\n        this.videoStatusSection.style.display = 'none';\n        return;\n      }\n\n      // Query content script for video state\n      const response = await chrome.tabs.sendMessage(tab.id, { type: 'GET_VIDEO_STATE' });\n\n      if (response?.success && response.data) {\n        this.updateVideoStatus(response.data);\n      }\n    } catch (error) {\n      // Content script not loaded or not on YouTube\n      this.videoStatusSection.style.display = 'none';\n    }\n  }\n\n  private updateVideoStatus(state: {\n    status: string;\n    progress: number;\n    error?: string;\n    intervalCount: number;\n    currentlyMuting: boolean;\n  }): void {\n    this.videoStatusSection.style.display = 'block';\n\n    // Update status text\n    const statusMap: Record<string, string> = {\n      idle: 'Ready',\n      loading: 'Loading...',\n      processing: 'Processing...',\n      active: 'Filtering',\n      error: 'Error',\n      disabled: 'Disabled',\n    };\n\n    this.videoStatusValue.textContent = statusMap[state.status] || state.status;\n\n    if (state.status === 'error' && state.error) {\n      this.videoStatusValue.textContent = state.error;\n      this.statusIndicator.classList.add('error');\n    }\n\n    // Update filtered count\n    this.filteredCount.textContent = state.intervalCount.toString();\n\n    // Update progress bar\n    if (state.status === 'processing') {\n      this.progressBar.style.display = 'block';\n      this.progressFill.style.width = `${state.progress}%`;\n    } else {\n      this.progressBar.style.display = 'none';\n    }\n  }\n\n  private setupMessageListener(): void {\n    chrome.runtime.onMessage.addListener((message) => {\n      if (message.type === 'VIDEO_STATE_CHANGED' && message.payload) {\n        this.updateVideoStatus(message.payload);\n      }\n    });\n  }\n}\n\n// Initialize when DOM is ready\ndocument.addEventListener('DOMContentLoaded', () => {\n  const popup = new PopupController();\n  popup.initialize();\n});\n"],"names":["DEFAULT_PREFERENCES","enabled","filterMode","severityLevels","mild","moderate","severe","customBlacklist","customWhitelist","paddingMs","paddingBeforeMs","paddingAfterMs","mergeThresholdMs","PopupController","preferences","initialize","this","enableToggle","document","getElementById","filterModeRadios","querySelectorAll","severityMild","severityModerate","severitySevere","statusIndicator","statusText","querySelector","videoStatusSection","videoStatusValue","filteredCount","progressBar","progressFill","loadPreferences","setupEventListeners","checkVideoStatus","setupMessageListener","response","chrome","runtime","sendMessage","type","success","data","updateUI","error","console","checked","body","classList","toggle","updateStatusIndicator","forEach","radio","value","remove","textContent","add","addEventListener","savePreferences","saveSeverityLevels","settingsLink","e","preventDefault","openOptionsPage","updates","payload","tab","tabs","query","active","currentWindow","id","url","includes","style","display","updateVideoStatus","state","idle","loading","processing","disabled","status","intervalCount","toString","width","progress","onMessage","addListener","message"],"ignoreList":[],"sourceRoot":""}